kind: Module
name: backend
description: Backend service container
type: container
dockerfile: "${environment.name == 'prod' ? 'Dockerfile.prod' : 'Dockerfile.dev'}"
# We need this because of: https://github.com/garden-io/garden/issues/1707
include: ["*"]
build:
  dependencies: [base-image]
# The build arguments to use when building the image.
# Corresponds to the ARG directive in the Dockerfile.
buildArgs:
  BASE_IMAGE: ${modules.base-image.outputs.deployment-image-name}:${modules.base-image.version}
services:
  - name: backend
    ports:
      - name: http
        containerPort: 8080
        # Maps service:80 -> container:8080
        servicePort: 80
    ingresses:
      - path: /backend
        port: http
